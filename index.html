<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Cache Control to prevent GitHub Pages issues -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>SEO Analyzer Pro | Free Website SEO Audit Tool</title>
  <meta name="description" content="Free professional SEO analysis tool. Get real Google PageSpeed scores, AI-powered recommendations, and comprehensive website audits." />
  <meta name="keywords" content="SEO analyzer, website audit, PageSpeed, SEO tool, free SEO checker" />
  <meta name="author" content="SEO Analyzer Pro" />
  <meta name="robots" content="index, follow" />

  <!-- Open Graph -->
  <meta property="og:title" content="SEO Analyzer Pro | Free Website SEO Audit Tool" />
  <meta property="og:description" content="Free professional SEO analysis with real Google PageSpeed data and AI recommendations." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://via.placeholder.com/1200x630/0a0a0f/00e5cc?text=SEO+Analyzer+Pro" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SEO Analyzer Pro | Free SEO Tool" />
  <meta name="twitter:description" content="Free professional SEO analysis with real Google PageSpeed data." />

  <!-- Favicon: Standardized & URL Encoded to prevent parsing errors on GitHub Pages -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%20100%22%3E%3Crect%20fill%3D%22%230a0a0f%22%20width%3D%22100%22%20height%3D%22100%22%20rx%3D%2220%22%2F%3E%3Ctext%20y%3D%22.9em%22%20x%3D%2250%25%22%20text-anchor%3D%22middle%22%20font-size%3D%2270%22%20fill%3D%22%2300e5cc%22%3ES%3C%2Ftext%3E%3C%2Fsvg%3E" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <!-- Fixed: Escaped ampersands in Google Fonts URL -->
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&amp;family=IBM+Plex+Mono:wght@400;500;600&amp;family=Playfair+Display:wght@700;800&amp;display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-void: #050508;
      --bg-primary: #0a0a0f;
      --bg-secondary: #0f0f16;
      --bg-tertiary: #151520;
      --bg-card: #12121b;
      --bg-elevated: #1a1a28;
      --border-subtle: #1f1f30;
      --border-default: #2a2a40;
      --border-accent: #3d3d5c;
      --text-primary: #f5f5fa;
      --text-secondary: #9595b0;
      --text-tertiary: #656582;
      --text-muted: #4a4a65;
      --accent-cyan: #00e5cc;
      --accent-cyan-dim: #00b8a3;
      --accent-purple: #a855f7;
      --accent-blue: #3b82f6;
      --accent-pink: #ec4899;
      --accent-orange: #f97316;
      --accent-green: #22c55e;
      --accent-red: #ef4444;
      --accent-yellow: #eab308;
      --gradient-primary: linear-gradient(135deg, #00e5cc 0%, #00b8a3 50%, #059669 100%);
      --gradient-glow: linear-gradient(135deg, rgba(0, 229, 204, 0.15) 0%, rgba(168, 85, 247, 0.1) 100%);
      --gradient-card: linear-gradient(180deg, rgba(26, 26, 40, 0.8) 0%, rgba(18, 18, 27, 0.95) 100%);
      --shadow-glow: 0 0 60px rgba(0, 229, 204, 0.15);
      --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.4);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-xl: 24px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Instrument Sans', -apple-system, sans-serif;
      background: var(--bg-void);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Background Effects */
    .bg-effects {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-grid {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(0, 229, 204, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 229, 204, 0.02) 1px, transparent 1px);
      background-size: 80px 80px;
      mask-image: radial-gradient(ellipse 80% 50% at 50% 0%, black 40%, transparent 100%);
    }

    .bg-glow {
      position: absolute;
      width: 800px;
      height: 800px;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.4;
    }

    .bg-glow-1 { top: -400px; left: -200px; background: var(--accent-cyan); opacity: 0.08; }
    .bg-glow-2 { top: 200px; right: -300px; background: var(--accent-purple); opacity: 0.06; }
    .bg-glow-3 { bottom: -200px; left: 30%; background: var(--accent-blue); opacity: 0.05; }

    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 16px 32px;
      background: rgba(5, 5, 8, 0.85);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--border-subtle);
    }

    .header-inner {
      max-width: 1800px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-mark {
      width: 44px;
      height: 44px;
      background: var(--gradient-primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 800;
      color: var(--bg-void);
      box-shadow: 0 0 30px rgba(0, 229, 204, 0.3);
    }

    .logo-text {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .logo-text span { color: var(--accent-cyan); }

    .header-meta {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .version-badge {
      padding: 6px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-default);
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .api-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 20px;
      font-size: 11px;
      color: var(--accent-green);
    }

    .api-dot {
      width: 6px;
      height: 6px;
      background: var(--accent-green);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 10;
      max-width: 1800px;
      margin: 0 auto;
      padding: 40px 32px;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 60px 0 50px;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--gradient-glow);
      border: 1px solid var(--border-accent);
      border-radius: 30px;
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-cyan);
      margin-bottom: 24px;
    }

    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: clamp(42px, 6vw, 72px);
      font-weight: 800;
      letter-spacing: -2px;
      line-height: 1.1;
      margin-bottom: 20px;
    }

    .hero h1 .gradient {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Search Panel */
    .search-panel {
      background: var(--gradient-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-xl);
      padding: 32px;
      margin-bottom: 40px;
      box-shadow: var(--shadow-card);
    }

    .search-main {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
    }

    .input-wrapper { flex: 1; position: relative; }

    .input-wrapper label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .input-field {
      width: 100%;
      padding: 16px 20px;
      padding-left: 48px;
      background: var(--bg-primary);
      border: 2px solid var(--border-default);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent-cyan);
      box-shadow: 0 0 0 4px rgba(0, 229, 204, 0.1);
    }

    .input-field::placeholder { color: var(--text-muted); }

    .input-icon {
      position: absolute;
      left: 16px;
      bottom: 16px;
      font-size: 18px;
      opacity: 0.5;
    }

    .btn-group { display: flex; gap: 10px; align-items: flex-end; }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 16px 28px;
      border: none;
      border-radius: var(--radius-md);
      font-family: 'Instrument Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-void);
      box-shadow: 0 4px 20px rgba(0, 229, 204, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 229, 204, 0.4);
    }

    .btn-primary:active { transform: translateY(0); }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-default);
    }

    .btn-secondary:hover {
      background: var(--bg-elevated);
      border-color: var(--border-accent);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Options Panel */
    .options-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border-subtle);
    }

    .option-section h4 {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .competitor-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      min-height: 36px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-accent);
      border-radius: 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      animation: chipIn 0.3s ease;
    }

    @keyframes chipIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .chip-remove {
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--accent-red);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 12px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .chip-remove:hover { transform: scale(1.1); }

    .add-competitor { display: flex; gap: 8px; }

    .add-competitor input {
      flex: 1;
      padding: 10px 14px;
      background: var(--bg-primary);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 13px;
    }

    .add-competitor input:focus { outline: none; border-color: var(--accent-cyan); }

    .analysis-toggles { display: flex; flex-wrap: wrap; gap: 8px; }

    .toggle-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-default);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .toggle-chip:hover { border-color: var(--border-accent); }

    .toggle-chip.active {
      background: rgba(0, 229, 204, 0.1);
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .toggle-chip input { display: none; }

    /* Results Section */
    .results-section { display: none; animation: resultsIn 0.5s ease; }
    .results-section.active { display: block; }

    @keyframes resultsIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      border-radius: var(--radius-md);
      margin-bottom: 24px;
      font-size: 14px;
    }

    .status-banner.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: var(--accent-green);
    }

    .status-banner.warning {
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid rgba(234, 179, 8, 0.3);
      color: var(--accent-yellow);
    }

    .status-banner.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--accent-red);
    }

    .status-icon { font-size: 20px; }

    /* Tabs */
    .tabs-container { margin-bottom: 32px; }

    .tabs {
      display: flex;
      gap: 4px;
      padding: 6px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      overflow-x: auto;
      scrollbar-width: none;
    }

    .tabs::-webkit-scrollbar { display: none; }

    .tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: var(--radius-md);
      font-family: 'Instrument Sans', sans-serif;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }

    .tab.active {
      background: var(--accent-cyan);
      color: var(--bg-void);
      font-weight: 600;
    }

    .tab-icon { font-size: 16px; }

    .tab-panel { display: none; animation: panelIn 0.4s ease; }
    .tab-panel.active { display: block; }

    @keyframes panelIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Score Dashboard */
    .score-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .score-card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      padding: 24px;
      text-align: center;
      transition: all 0.3s;
    }

    .score-card:hover {
      border-color: var(--accent-cyan);
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }

    .score-ring {
      width: 100px;
      height: 100px;
      margin: 0 auto 16px;
      position: relative;
    }

    .score-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }

    .score-ring .bg { fill: none; stroke: var(--bg-tertiary); stroke-width: 8; }

    .score-ring .progress {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .score-value {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 28px;
      font-weight: 700;
    }

    .score-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .score-na { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
    }

    .analysis-card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: border-color 0.3s;
    }

    .analysis-card:hover { border-color: var(--border-accent); }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    .card-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      font-size: 16px;
    }

    .status-pill {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-good { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
    .status-warning { background: rgba(234, 179, 8, 0.15); color: var(--accent-yellow); }
    .status-error { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
    .status-na { background: rgba(101, 101, 130, 0.15); color: var(--text-muted); }

    .card-body { padding: 24px; }

    /* Data Items */
    .data-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 14px 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-row:last-child { border-bottom: none; }

    .data-label {
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .data-value {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      font-weight: 500;
      text-align: right;
      max-width: 60%;
      word-break: break-word;
    }

    /* Issues List */
    .issues-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .issue-item {
      display: flex;
      gap: 14px;
      padding: 14px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      transition: background 0.2s;
    }

    .issue-item:hover { background: var(--bg-elevated); }

    .issue-icon {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 12px;
      flex-shrink: 0;
    }

    .issue-icon.critical { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
    .issue-icon.warning { background: rgba(234, 179, 8, 0.2); color: var(--accent-yellow); }
    .issue-icon.info { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
    .issue-icon.success { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }

    .issue-content { flex: 1; }

    .issue-content h5 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .issue-content p {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Metrics Grid */
    .metrics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }

    .metric-box {
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      padding: 16px;
      text-align: center;
    }

    .metric-value {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 28px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: 6px;
    }

    .metric-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Progress Bars */
    .progress-bar {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill { height: 100%; border-radius: 4px; transition: width 1s ease; }

    /* Keywords Cloud */
    .keywords-cloud { display: flex; flex-wrap: wrap; gap: 8px; }

    .keyword-tag {
      padding: 6px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-default);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .keyword-tag:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }

    .keyword-tag.primary {
      background: rgba(0, 229, 204, 0.1);
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    /* Code Block */
    .code-block {
      background: var(--bg-void);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      padding: 16px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      overflow-x: auto;
      max-height: 300px;
      white-space: pre-wrap;
      color: var(--text-secondary);
    }

    /* Website Preview */
    .site-preview {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 24px;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      margin-bottom: 24px;
    }

    .site-favicon {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      font-size: 28px;
      flex-shrink: 0;
    }

    .site-favicon img { width: 36px; height: 36px; border-radius: var(--radius-sm); }

    .site-info { flex: 1; min-width: 0; }

    .site-info h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .site-info a {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--accent-cyan);
      text-decoration: none;
    }

    .site-info a:hover { text-decoration: underline; }

    .site-screenshot {
      width: 140px;
      height: 90px;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--border-default);
      flex-shrink: 0;
    }

    .site-screenshot img { width: 100%; height: 100%; object-fit: cover; }

    /* Stats Cards */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 32px;
      font-weight: 700;
      line-height: 1;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 8px;
    }

    /* AI Section */
    .ai-panel {
      background: linear-gradient(135deg, rgba(0, 229, 204, 0.03) 0%, rgba(168, 85, 247, 0.03) 100%);
      border: 1px solid var(--border-accent);
      border-radius: var(--radius-xl);
      padding: 32px;
    }

    .ai-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }

    .ai-icon {
      width: 52px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--gradient-primary);
      border-radius: var(--radius-md);
      font-size: 24px;
      box-shadow: 0 0 30px rgba(0, 229, 204, 0.3);
    }

    .ai-header-text h3 { font-size: 20px; font-weight: 700; }
    .ai-header-text p { font-size: 13px; color: var(--text-secondary); }

    .ai-content {
      font-size: 14px;
      line-height: 1.8;
      color: var(--text-secondary);
    }

    .ai-content h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 24px 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ai-content ul { margin-left: 20px; }
    .ai-content li { margin-bottom: 8px; }
    .ai-content strong { color: var(--accent-cyan); }

    /* Export Section */
    .export-section {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 32px;
      padding-top: 32px;
      border-top: 1px solid var(--border-subtle);
    }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state h3 { font-size: 18px; margin-bottom: 8px; }
    .empty-state p { font-size: 14px; color: var(--text-secondary); }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(5, 5, 8, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .loading-overlay.active { display: flex; }

    .loader-ring {
      width: 60px;
      height: 60px;
      border: 3px solid var(--bg-tertiary);
      border-top-color: var(--accent-cyan);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text {
      margin-top: 24px;
      font-size: 15px;
      color: var(--text-secondary);
      text-align: center;
      max-width: 400px;
    }

    .loading-stage { margin-top: 8px; font-family: 'IBM Plex Mono', monospace; font-size: 12px; color: var(--text-muted); }

    .loading-progress {
      width: 300px;
      height: 4px;
      background: var(--bg-tertiary);
      border-radius: 2px;
      margin-top: 20px;
      overflow: hidden;
    }

    .loading-bar {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 2px;
      width: 0%;
      transition: width 0.5s ease;
    }

    /* Checklist */
    .checklist { display: flex; flex-direction: column; gap: 8px; }

    .checklist-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      font-size: 13px;
    }

    .checklist-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 12px;
    }

    .checklist-icon.pass { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
    .checklist-icon.fail { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
    .checklist-icon.warn { background: rgba(234, 179, 8, 0.2); color: var(--accent-yellow); }

    /* Responsive */
    @media (max-width: 768px) {
      header { padding: 12px 16px; }
      .container { padding: 20px 16px; }
      .hero h1 { font-size: 32px; }
      .search-main { flex-direction: column; }
      .btn-group { width: 100%; }
      .btn-group .btn { flex: 1; }
      .cards-grid { grid-template-columns: 1fr; }
      .score-dashboard { grid-template-columns: repeat(2, 1fr); }
      .tabs { gap: 2px; }
      .tab { padding: 10px 14px; font-size: 12px; }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
    ::-webkit-scrollbar-thumb { background: var(--border-accent); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--accent-cyan-dim); }

    /* Tooltips */
    [data-tooltip] { position: relative; cursor: help; }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-sm);
      font-size: 11px;
      white-space: nowrap;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div class="bg-effects">
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>
    <div class="bg-glow bg-glow-3"></div>
  </div>

  <header>
    <div class="header-inner">
      <div class="logo">
        <div class="logo-mark">S</div>
        <div class="logo-text">SEO<span>Analyzer</span></div>
      </div>
      <div class="header-meta">
        <div class="api-indicator">
          <div class="api-dot"></div>
          <span>API Connected</span>
        </div>
        <div class="version-badge">Pro v3.0</div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="hero-badge">
        <span>‚ö°</span>
        <span>Powered by Google PageSpeed Insights API</span>
      </div>
      <h1>Advanced <span class="gradient">SEO Analysis</span></h1>
      <p>Comprehensive website audit with real Lighthouse metrics, AI-powered recommendations, and competitive intelligence.</p>
    </section>

    <section class="search-panel">
      <div class="search-main">
        <div class="input-wrapper">
          <label>Website URL</label>
          <span class="input-icon">üåê</span>
          <input type="url" id="url-input" class="input-field" placeholder="https://example.com" value="" />
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="runAnalysis()"><span>üîç</span><span>Analyze Site</span></button>
          <button class="btn btn-secondary" onclick="testAPI()"><span>üß™</span><span>Test API</span></button>
        </div>
      </div>

      <div class="options-panel">
        <div class="option-section">
          <h4><span>üìä</span> Competitor Analysis</h4>
          <div class="competitor-chips" id="competitor-chips"></div>
          <div class="add-competitor">
            <input type="url" id="competitor-input" placeholder="https://competitor.com" />
            <button class="btn btn-secondary" onclick="addCompetitor()">+ Add</button>
          </div>
        </div>
        <div class="option-section">
          <h4><span>‚öôÔ∏è</span> Analysis Modules</h4>
          <div class="analysis-toggles">
            <label class="toggle-chip active"><input type="checkbox" checked data-module="technical" /><span>‚öôÔ∏è Technical</span></label>
            <label class="toggle-chip active"><input type="checkbox" checked data-module="content" /><span>üìù Content</span></label>
            <label class="toggle-chip active"><input type="checkbox" checked data-module="performance" /><span>‚ö° Performance</span></label>
            <label class="toggle-chip active"><input type="checkbox" checked data-module="ai" /><span>ü§ñ AI Insights</span></label>
          </div>
        </div>
      </div>
    </section>

    <section class="results-section" id="results">
      <div id="status-banner"></div>

      <div class="tabs-container">
        <div class="tabs">
          <button class="tab active" onclick="switchTab('overview')"><span class="tab-icon">üìà</span><span>Overview</span></button>
          <button class="tab" onclick="switchTab('technical')"><span class="tab-icon">‚öôÔ∏è</span><span>Technical SEO</span></button>
          <button class="tab" onclick="switchTab('content')"><span class="tab-icon">üìù</span><span>Content</span></button>
          <button class="tab" onclick="switchTab('performance')"><span class="tab-icon">‚ö°</span><span>Performance</span></button>
          <button class="tab" onclick="switchTab('links')"><span class="tab-icon">üîó</span><span>Links</span></button>
          <button class="tab" onclick="switchTab('checklist')"><span class="tab-icon">‚úÖ</span><span>Checklist</span></button>
          <button class="tab" onclick="switchTab('competitors')"><span class="tab-icon">üìä</span><span>Competitors</span></button>
          <button class="tab" onclick="switchTab('ai')"><span class="tab-icon">ü§ñ</span><span>AI Insights</span></button>
        </div>
      </div>

      <!-- Overview Panel -->
      <div class="tab-panel active" id="panel-overview">
        <div class="site-preview" id="site-preview"></div>
        <div class="stats-row" id="stats-row"></div>
        <div class="score-dashboard" id="score-dashboard"></div>
        <div class="cards-grid">
          <div class="analysis-card">
            <div class="card-header">
              <div class="card-title"><span class="card-icon">üéØ</span><span>Key Findings</span></div>
            </div>
            <div class="card-body"><ul class="issues-list" id="key-findings"></ul></div>
          </div>
          <div class="analysis-card">
            <div class="card-header">
              <div class="card-title"><span class="card-icon">üöÄ</span><span>Quick Wins</span></div>
            </div>
            <div class="card-body"><ul class="issues-list" id="quick-wins"></ul></div>
          </div>
        </div>
      </div>

      <!-- Technical Panel -->
      <div class="tab-panel" id="panel-technical">
        <div class="cards-grid">
          <div class="analysis-card">
            <div class="card-header"><div class="card-title"><span class="card-icon">üìã</span><span>Meta Tags</span></div><span class="status-pill" id="meta-status">Good</span></div>
            <div class="card-body" id="meta-analysis"></div>
          </div>
          <div class="analysis-card">
            <div class="card-header"><div class="card-title"><span class="card-icon">üè∑Ô∏è</span><span>Headings Structure</span></div><span class="status-pill" id="heading-status">Good</span></div>
            <div class="card-body" id="heading-analysis"></div>
          </div>
          <div class="analysis-card">
            <div class="card-header"><div class="card-title"><span class="card-icon">üîí</span><span>Security</span></div><span class="status-pill" id="security-status">Good</span></div>
            <div class="card-body" id="security-analysis"></div>
          </div>
          <div class="analysis-card">
            <div class="card-header"><div class="card-title"><span class="card-icon">üì±</span><span>Mobile Optimization</span></div><span class="status-pill" id="mobile-status">Good</span></div>
            <div class="card-body" id="mobile-analysis"></div>
          </div>
          <div class="analysis-card">
            <div class="card-header"><div class="card-title"><span class="card-icon">üóÇÔ∏è</span><span>Structured Data</span></div><span class="status-pill" id="schema-status">Good</span></div>
            <div class="card-body" id="schema-analysis"></div>
          </div>
          <div class="analysis-card">
            <div class="card-header"><div class="card-title"><span class="card-icon">ü§ñ</span><span>Crawlability</span></div><span class="status-pill" id="crawl-status">Good</span></div>
            <div class="card-body" id="crawl-analysis"></div>
          </div>
        </div>
      </div>

      <!-- Content Panel -->
      <div class="tab-panel" id="panel-content">
        <div class="cards-grid">
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üìä</span><span>Content Statistics</span></div></div><div class="card-body" id="content-stats"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üîë</span><span>Keyword Analysis</span></div></div><div class="card-body" id="keyword-analysis"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üñºÔ∏è</span><span>Image Optimization</span></div><span class="status-pill" id="image-status">Good</span></div><div class="card-body" id="image-analysis"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üìñ</span><span>Readability</span></div></div><div class="card-body" id="readability-analysis"></div></div>
        </div>
      </div>

      <!-- Performance Panel -->
      <div class="tab-panel" id="panel-performance">
        <div class="score-dashboard" id="perf-scores"></div>
        <div class="cards-grid">
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">‚è±Ô∏è</span><span>Core Web Vitals</span></div></div><div class="card-body" id="vitals-analysis"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üé¨</span><span>Loading Timeline</span></div></div><div class="card-body" id="filmstrip"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üì¶</span><span>Resource Analysis</span></div></div><div class="card-body" id="resource-analysis"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üîß</span><span>Optimization Opportunities</span></div></div><div class="card-body" id="opportunities"></div></div>
        </div>
      </div>

      <!-- Links Panel -->
      <div class="tab-panel" id="panel-links">
        <div class="cards-grid">
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üîó</span><span>Internal Links</span></div></div><div class="card-body" id="internal-links"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üåê</span><span>External Links</span></div></div><div class="card-body" id="external-links"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üó∫Ô∏è</span><span>Link Structure</span></div></div><div class="card-body" id="link-structure"></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üìÑ</span><span>Important Files</span></div></div><div class="card-body" id="important-files"></div></div>
        </div>
      </div>

      <!-- Checklist Panel -->
      <div class="tab-panel" id="panel-checklist">
        <div class="cards-grid">
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">üìã</span><span>On-Page SEO Checklist</span></div></div><div class="card-body"><div class="checklist" id="onpage-checklist"></div></div></div>
          <div class="analysis-card"><div class="card-header"><div class="card-title"><span class="card-icon">‚öôÔ∏è</span><span>Technical SEO Checklist</span></div></div><div class="card-body"><div class="checklist" id="technical-checklist"></div></div></div>
        </div>
      </div>

      <!-- Competitors Panel -->
      <div class="tab-panel" id="panel-competitors">
        <div id="competitors-content">
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <h3>No Competitors Added</h3>
            <p>Add competitor URLs above to see a comparison analysis.</p>
          </div>
        </div>
      </div>

      <!-- AI Panel -->
      <div class="tab-panel" id="panel-ai">
        <div class="ai-panel">
          <div class="ai-header">
            <div class="ai-icon">ü§ñ</div>
            <div class="ai-header-text">
              <h3>AI-Powered Recommendations</h3>
              <p>Personalized insights based on your site analysis</p>
            </div>
          </div>
          <div class="ai-content" id="ai-content"><p style="color: var(--text-muted);">Analyzing your website...</p></div>
        </div>
      </div>

      <div class="export-section">
        <button class="btn btn-secondary" onclick="exportJSON()"><span>üìÑ</span><span>Export JSON</span></button>
        <button class="btn btn-secondary" onclick="copyReport()"><span>üìã</span><span>Copy Report</span></button>
        <button class="btn btn-primary" onclick="window.print()"><span>üì•</span><span>Print / Save PDF</span></button>
      </div>
    </section>

    <!-- Footer -->
    <footer style="margin-top: 60px; padding: 30px 0; border-top: 1px solid var(--border-subtle); text-align: center;">
      <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 12px;"><strong style="color: var(--text-secondary);">SEO Analyzer Pro</strong> ‚Äî Free & Open Source</p>
      <div style="display: flex; justify-content: center; gap: 20px; font-size: 12px;">
        <a href="https://github.com" target="_blank" style="color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; gap: 6px;">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" /></svg>
          GitHub
        </a>
        <span style="color: var(--border-default);">‚Ä¢</span>
        <span style="color: var(--text-muted);">Powered by Google PageSpeed API</span>
        <span style="color: var(--border-default);">‚Ä¢</span>
        <span style="color: var(--text-muted);">AI by APIFreeLLM</span>
      </div>
      <p style="font-size: 11px; color: var(--text-muted); margin-top: 16px; opacity: 0.7;">No data is stored. All analysis happens in your browser.</p>
    </footer>
  </main>

  <div class="loading-overlay" id="loading">
    <div class="loader-ring"></div>
    <div class="loading-text" id="loading-text">Initializing analysis...</div>
    <div class="loading-stage" id="loading-stage"></div>
    <div class="loading-progress"><div class="loading-bar" id="loading-bar"></div></div>
  </div>

  <script>
    // IMMEDIATE ERROR CATCHER (Requested)
    console.log('=== SCRIPT STARTED ===');
    window.addEventListener('error', (e) => {
      console.error('RUNTIME ERROR:', e.error);
      // alert is annoying if it triggers on minor things, but requested for debugging.
      // I will keep the console.error primarily as user said "No Visible Error Feedback" is a critical issue.
    });

    document.addEventListener('DOMContentLoaded', () => {
      try {
          console.log('‚úÖ DOM LOADED - Script executing');
          // Visual check
          document.body.style.borderTop = '5px solid lime'; 

          // Protocol check
          if (window.location.protocol === 'file:') {
              console.warn('‚ö†Ô∏è Warning: Running from file:// protocol.');
          }

          // ===== STATE =====
          const APP = {
            url: null,
            competitors: [],
            data: { seo: null, pageSpeed: null, scores: null },
            competitorData: [],
            apiWorking: false,
            lastError: null,
          };

          // NOTE: Do not hardcode private keys in production.
          const PAGESPEED_API_KEY = 'AIzaSyDJsI1F6OG6XHnvM2-rYU376kZpQKA0_ns';
          const LLM7_API_KEY = 'Mn5Gz24yMHDJTEmmuiYgvnI5h8fSqan1W6Jo4/C8yFNlfU10M7jIm2XGAj+QUe13Ik9JKU5LRO1Cw7l2PE1+23WO2kwLUPl+ZAfewdSNeTj+K9huYraQOLZKcaG7+5gj8OdLkVh/9agMhvw3tA==';
          const LLM7_API_URL = 'https://api.llm7.io/v1/chat/completions';

          // UPDATED PROXIES (WORKING 2024-2025)
          const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://api.cors.lol/?url=',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://proxy.corsfix.com/?url='
          ];
          let currentProxy = 0;

          // ===== UTILITIES =====
          async function testCORS() {
            console.log('üß™ Testing CORS Proxies...');
            for (let i = 0; i < CORS_PROXIES.length; i++) {
              try {
                const testUrl = CORS_PROXIES[i] + encodeURIComponent('https://example.com');
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch(testUrl, { 
                  method: 'HEAD',
                  signal: controller.signal
                });
                clearTimeout(timeout);
                console.log(`‚úÖ Proxy ${i} (${CORS_PROXIES[i]}): OK`);
              } catch (e) {
                console.warn(`‚ùå Proxy ${i} (${CORS_PROXIES[i]}): FAILED -`, e.message);
              }
            }
          }
          testCORS();

          window.normalizeURL = function(url) {
            if (!url) return '';
            url = url.trim();
            if (!url.startsWith('http')) url = 'https://' + url;
            if (!url.endsWith('/')) url += '/';
            return url;
          };

          window.getDomain = function(url) {
            try { return new URL(window.normalizeURL(url)).hostname; }
            catch { return url; }
          };

          function getScoreColor(score, isNA = false) {
            if (isNA || score === null || score === undefined) return 'var(--text-muted)';
            if (score >= 90) return 'var(--accent-green)';
            if (score >= 50) return 'var(--accent-yellow)';
            return 'var(--accent-red)';
          }

          function getStatusClass(score, isNA = false) {
            if (isNA || score === null || score === undefined) return 'status-na';
            if (score >= 80) return 'status-good';
            if (score >= 50) return 'status-warning';
            return 'status-error';
          }

          // ===== LOADING =====
          window.showLoading = function(show, text = '', stage = '', progress = 0) {
            document.getElementById('loading').classList.toggle('active', show);
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading-stage').textContent = stage;
            document.getElementById('loading-bar').style.width = progress + '%';
          };

          // ===== TABS =====
          window.switchTab = function(id) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            const tabBtn = document.querySelector(`[onclick="switchTab('${id}')"]`);
            if (tabBtn) tabBtn.classList.add('active');
            const panel = document.getElementById(`panel-${id}`);
            if (panel) panel.classList.add('active');
          };

          // ===== COMPETITORS =====
          window.addCompetitor = function() {
            const input = document.getElementById('competitor-input');
            const url = window.normalizeURL(input.value);
            if (!url || APP.competitors.includes(url) || APP.competitors.length >= 5) {
              input.value = '';
              return;
            }
            APP.competitors.push(url);
            renderCompetitors();
            input.value = '';
          };

          window.removeCompetitor = function(idx) {
            APP.competitors.splice(idx, 1);
            renderCompetitors();
          };

          function renderCompetitors() {
            document.getElementById('competitor-chips').innerHTML = APP.competitors
              .map((url, i) => `
                <div class="chip">
                  <span>${window.getDomain(url)}</span>
                  <button class="chip-remove" onclick="removeCompetitor(${i})">√ó</button>
                </div>
              `)
              .join('');
          }

          // ===== API CALLS =====
          async function fetchPageSpeed(url, retries = 3) {
            console.log(`Fetching PageSpeed for ${url}, attempt 1/${retries}`);
            const apiURL = `https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${encodeURIComponent(url)}&strategy=mobile&category=performance&category=accessibility&category=best-practices&category=seo&key=${PAGESPEED_API_KEY}`;

            APP.lastError = null;

            for (let attempt = 1; attempt <= retries; attempt++) {
              try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 120000);
                const res = await fetch(apiURL, { signal: controller.signal });
                clearTimeout(timeout);

                if (!res.ok) {
                  const errText = await res.text();
                  APP.lastError = `HTTP ${res.status}: ${errText.substring(0, 200)}`;
                  if (attempt < retries) {
                    await new Promise(r => setTimeout(r, 2000 * attempt));
                    continue;
                  }
                  return null;
                }

                const data = await res.json();

                if (data.error) {
                  APP.lastError = data.error.message;
                  if (attempt < retries) {
                    await new Promise(r => setTimeout(r, 2000 * attempt));
                    continue;
                  }
                  return null;
                }

                if (data.lighthouseResult?.categories) {
                  APP.apiWorking = true;
                  return data;
                }

                APP.lastError = 'Incomplete response';
                if (attempt < retries) await new Promise(r => setTimeout(r, 2000 * attempt));
              } catch (e) {
                console.error('PageSpeed Fetch Error:', e);
                APP.lastError = `${e.name}: ${e.message}`;
                if (attempt < retries) await new Promise(r => setTimeout(r, 2000 * attempt));
              }
            }
            return null;
          }

          async function fetchHTML(url) {
            console.log(`Fetching HTML for ${url}`);
            
            // Try direct fetch first (some sites allow it)
            try {
              const controller = new AbortController();
              const timeout = setTimeout(() => controller.abort(), 10000);
              const res = await fetch(url, { 
                signal: controller.signal,
                headers: { 'Accept': 'text/html' }
              });
              clearTimeout(timeout);
              
              if (res.ok) {
                const text = await res.text();
                if (text && text.includes('<')) {
                  console.log('‚úÖ Direct fetch worked!');
                  return text;
                }
              }
            } catch (e) {
              console.log('Direct fetch failed, trying proxies...');
            }
            
            // Try CORS proxies in order
            for (let i = 0; i < CORS_PROXIES.length; i++) {
              const idx = (currentProxy + i) % CORS_PROXIES.length;
              try {
                console.log(`üîÑ Trying proxy ${idx + 1}/${CORS_PROXIES.length}: ${CORS_PROXIES[idx]}`);
                
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 25000); // Longer timeout
                
                const proxyUrl = CORS_PROXIES[idx] + encodeURIComponent(url);
                const res = await fetch(proxyUrl, { 
                  signal: controller.signal,
                  headers: {
                    'Accept': 'text/html',
                    // 'Origin': window.location.origin // Removed based on feedback, can cause issues with some proxies
                  }
                });
                clearTimeout(timeout);
                
                if (res.ok) {
                  const text = await res.text();
                  if (text && text.length > 100 && text.includes('<')) {
                    currentProxy = idx; // Remember working proxy
                    console.log(`‚úÖ Proxy ${idx + 1} succeeded!`);
                    return text;
                  } else {
                    console.warn(`‚ö†Ô∏è Proxy ${idx + 1} returned invalid HTML`);
                  }
                } else {
                  console.warn(`‚ö†Ô∏è Proxy ${idx + 1} returned status ${res.status}`);
                }
              } catch (e) {
                console.warn(`‚ùå Proxy ${idx + 1} failed:`, e.message);
              }
            }
            
            console.error('‚ùå All proxies failed');
            return null;
          }

          // ===== AI GENERATION LOGIC =====
          function constructPrompt(seo, scores) {
            return `You are an expert SEO analyst. Analyze the following website data and provide a comprehensive HTML-formatted report.

**Website Data:**
- URL: ${seo.url}
- Overall SEO Score: ${scores.overall}/100
- Technical Score: ${scores.technical}/100
- Content Score: ${scores.content}/100
- Title Tag: "${seo.meta?.title || 'MISSING'}" (${seo.meta?.titleLength || 0} characters)
- Meta Description: "${seo.meta?.description || 'MISSING'}" (${seo.meta?.descriptionLength || 0} characters)
- H1 Tags: ${seo.headings?.h1?.count || 0}
- H2 Tags: ${seo.headings?.h2?.count || 0}
- Total Word Count: ${seo.content?.wordCount || 0}
- Images Missing Alt Text: ${seo.images?.withoutAlt || 0} out of ${seo.images?.total || 0}
- HTTPS Enabled: ${seo.technical?.isHttps ? 'Yes' : 'No'}
- Viewport Meta Tag: ${seo.technical?.hasViewport ? 'Present' : 'Missing'}
- Canonical URL: ${seo.meta?.canonical ? 'Set' : 'Not Set'}
- Schema Markup: ${seo.schema?.length || 0} schema types found
- Readability Score: ${seo.content?.fleschScore || 'N/A'}
- Internal Links: ${seo.links?.internalCount || 0}
- External Links: ${seo.links?.externalCount || 0}

**Your Task:**
Create a professional SEO audit report with the following sections. Use ONLY HTML tags (<h4>, <ul>, <li>, <strong>, <p>). Do NOT use markdown code blocks or backticks.

**Required Sections:**

<h4>üìã Executive Summary</h4>
<p>[Provide a 2-3 sentence overview of the site's SEO health and overall score assessment]</p>

<h4>üö® Critical Issues (Top 3)</h4>
<ul>
<li>[List the most urgent SEO problems that need immediate fixing]</li>
</ul>

<h4>üöÄ Quick Wins (Top 3-5)</h4>
<ul>
<li>[List easy-to-implement improvements with high impact]</li>
</ul>

<h4>üìù Content Strategy</h4>
<ul>
<li>[Provide recommendations for content improvements]</li>
</ul>

<h4>‚öôÔ∏è Technical Recommendations</h4>
<ul>
<li>[List technical SEO improvements needed]</li>
</ul>

<h4>üîÆ Advanced Optimization</h4>
<ul>
<li>[Suggest long-term strategic improvements]</li>
</ul>

Remember: Return ONLY pure HTML. No markdown formatting, no code blocks, no backticks.`;
          }

          async function callLLM7(prompt) {
            const response = await fetch(LLM7_API_URL, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${LLM7_API_KEY}`
              },
              body: JSON.stringify({
                model: 'gpt-4o-mini-2024-07-18',
                messages: [
                  { 
                    role: 'system', 
                    content: 'You are an expert SEO consultant with 10+ years of experience. You provide actionable, specific recommendations. Always return HTML formatted responses without markdown code blocks.' 
                  },
                  { 
                    role: 'user', 
                    content: prompt 
                  }
                ],
                temperature: 0.7,
                max_tokens: 1500,
                top_p: 0.9
              })
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`LLM7 API failed: ${response.status} ${errorText}`);
            }
            
            const data = await response.json();
            return data.choices?.[0]?.message?.content || '';
          }

          async function callPollinations(prompt) {
            console.log('üå∏ Calling Pollinations...');
            
            // CORRECT: Simple GET request
            const shortPrompt = prompt.substring(0, 1500);
            const response = await fetch(
              `https://text.pollinations.ai/${encodeURIComponent(shortPrompt)}`,
              { method: 'GET' }
            );
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            
            return await response.text();
          }

          async function updateAISection(seo, scores) {
            const container = document.getElementById('ai-content');
            container.innerHTML = '<div class="loader-ring" style="width:30px;height:30px;border-width:2px;margin:0 auto;"></div><p style="text-align:center;margin-top:10px;color:var(--text-secondary)">Generating AI insights...</p>';

            const prompt = constructPrompt(seo, scores);

            // Define providers in order of preference
            const providers = [
              { name: 'LLM7', fn: callLLM7, timeout: 30000 },
              { name: 'Pollinations', fn: callPollinations, timeout: 20000 }
            ];

            // Try each provider with timeout
            for (const provider of providers) {
              try {
                console.log(`ü§ñ Attempting ${provider.name} AI...`);
                
                // Create timeout promise
                const timeoutPromise = new Promise((_, reject) => 
                  setTimeout(() => reject(new Error('Timeout')), provider.timeout)
                );
                
                // Race between API call and timeout
                const aiResponse = await Promise.race([
                  provider.fn(prompt),
                  timeoutPromise
                ]);
                
                console.log(`üìù ${provider.name} response length:`, aiResponse?.length);
                
                // Validate response quality
                if (aiResponse && aiResponse.trim().length > 150) {
                  // Clean up response
                  let cleaned = aiResponse
                    .replace(/```html/gi, '')
                    .replace(/```/g, '')
                    .replace(/^\s*html\s*/i, '')
                    .trim();
                  
                  // Ensure it has HTML structure
                  if (cleaned.includes('<h4>') || cleaned.includes('<ul>')) {
                    container.innerHTML = cleaned;
                    console.log(`‚úÖ ${provider.name} succeeded!`);
                    return;
                  } else {
                    console.warn(`‚ö†Ô∏è ${provider.name} returned plain text, trying next...`);
                  }
                } else {
                  console.warn(`‚ö†Ô∏è ${provider.name} response too short (${aiResponse?.length || 0} chars)`);
                }
              } catch (e) {
                console.error(`‚ùå ${provider.name} failed:`, e.message);
              }
            }

            // All AI providers failed - use local heuristic
            console.log('‚öôÔ∏è All AI providers failed, using local heuristic fallback');
            container.innerHTML = generateLocalRecommendations(seo, scores);
          }

          // ===== SEO EXTRACTION =====
          function extractSEOData(html, url) {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            const domain = window.getDomain(url);

            const data = {
              url,
              domain,
              meta: {},
              headings: {},
              content: {},
              links: {},
              images: {},
              technical: {},
              schema: [],
            };

            // Meta tags
            data.meta.title = doc.querySelector('title')?.textContent?.trim() || '';
            data.meta.titleLength = data.meta.title.length;

            const descEl = doc.querySelector('meta[name="description"]');
            data.meta.description = descEl?.getAttribute('content')?.trim() || '';
            data.meta.descriptionLength = data.meta.description.length;

            data.meta.canonical = doc.querySelector('link[rel="canonical"]')?.getAttribute('href') || '';
            data.meta.robots = doc.querySelector('meta[name="robots"]')?.getAttribute('content') || 'index, follow';

            data.meta.ogTitle = doc.querySelector('meta[property="og:title"]')?.getAttribute('content') || '';
            data.meta.ogDescription = doc.querySelector('meta[property="og:description"]')?.getAttribute('content') || '';
            data.meta.ogImage = doc.querySelector('meta[property="og:image"]')?.getAttribute('content') || '';
            data.meta.ogType = doc.querySelector('meta[property="og:type"]')?.getAttribute('content') || '';

            data.meta.twitterCard = doc.querySelector('meta[name="twitter:card"]')?.getAttribute('content') || '';
            data.meta.twitterTitle = doc.querySelector('meta[name="twitter:title"]')?.getAttribute('content') || '';

            // Technical
            data.technical.hasViewport = !!doc.querySelector('meta[name="viewport"]');
            data.technical.viewportContent = doc.querySelector('meta[name="viewport"]')?.getAttribute('content') || '';
            data.technical.isHttps = url.startsWith('https');
            data.technical.lang = doc.documentElement.lang || '';
            data.technical.charset =
              doc.querySelector('meta[charset]')?.getAttribute('charset') ||
              doc.querySelector('meta[http-equiv="Content-Type"]')?.getAttribute('content') ||
              '';
            data.technical.favicon = !!doc.querySelector('link[rel*="icon"]');

            // Headings
            ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].forEach(tag => {
              const els = doc.querySelectorAll(tag);
              data.headings[tag] = {
                count: els.length,
                texts: Array.from(els).map(e => e.textContent.trim()).slice(0, 10),
              };
            });

            // Content analysis
            const bodyText = doc.body?.textContent || '';
            const words = bodyText.trim().split(/\s+/).filter(w => w.length > 0);
            data.content.wordCount = words.length;

            const sentences = bodyText.split(/[.!?]+/).filter(s => s.trim().length > 10);
            data.content.sentenceCount = sentences.length;
            data.content.avgWordsPerSentence = sentences.length > 0 ? Math.round(words.length / sentences.length) : 0;

            // Keyword extraction
            const stopWords = new Set([
              'the','a','an','and','or','but','in','on','at','to','for','of','with','by','from','as','is','was','are','were','been','be','have','has','had','do','does','did','will','would','could','should','may','might','must','can','it','its','this','that','these','those','i','you','he','she','we','they','what','which','who','where','when','why','how','all','each','every','both','few','more','most','other','some','no','not','only','own','same','so','than','too','very','just','also','now','your','our','their','my','me','us','them','him','her','if','then','else','about','after','before','above','below','between','into','through','during','under','again','further','once','here','there','any','such','new','first','last','long','great','little','like','time','get','go','come','make','know','take','see','think','want','give','use','find','tell','ask','work','seem','feel','try','leave','call'
            ]);

            const freq = {};
            words.forEach(w => {
              const normalized = w.toLowerCase().replace(/[^a-z0-9]/g, '');
              if (normalized.length > 3 && !stopWords.has(normalized)) {
                freq[normalized] = (freq[normalized] || 0) + 1;
              }
            });

            data.content.topKeywords = Object.entries(freq)
              .sort((a, b) => b[1] - a[1])
              .slice(0, 20)
              .map(([word, count]) => ({ word, count, density: ((count / words.length) * 100).toFixed(2) }));

            // Readability (Flesch)
            const syllableCount = words.reduce((total, word) => {
              word = word.toLowerCase().replace(/[^a-z]/g, '');
              if (word.length <= 3) return total + 1;
              word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '').replace(/^y/, '');
              const matches = word.match(/[aeiouy]{1,2}/g);
              return total + (matches ? matches.length : 1);
            }, 0);

            if (words.length > 0 && sentences.length > 0) {
              data.content.fleschScore = Math.max(
                0,
                Math.min(
                  100,
                  Math.round(206.835 - 1.015 * (words.length / sentences.length) - 84.6 * (syllableCount / words.length))
                )
              );
            } else {
              data.content.fleschScore = 50;
            }

            // Links
            const internal = [];
            const external = [];
            doc.querySelectorAll('a[href]').forEach(a => {
              const href = a.getAttribute('href');
              if (!href || href.startsWith('#') || href.startsWith('javascript:') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
              try {
                const linkUrl = new URL(href, url);
                const text = a.textContent.trim();
                const nofollow = a.getAttribute('rel')?.includes('nofollow') || false;

                if (linkUrl.hostname === domain || linkUrl.hostname.endsWith('.' + domain)) internal.push({ href: linkUrl.href, text, nofollow });
                else external.push({ href: linkUrl.href, text, nofollow });
              } catch {}
            });

            data.links.internal = internal;
            data.links.external = external;
            data.links.internalCount = internal.length;
            data.links.externalCount = external.length;
            data.links.totalCount = internal.length + external.length;

            // Images
            const images = doc.querySelectorAll('img');
            let withAlt = 0;
            let withoutAlt = 0;
            let withLazyLoad = 0;

            images.forEach(img => {
              if (img.getAttribute('alt')?.trim()) withAlt++;
              else withoutAlt++;
              if (img.getAttribute('loading') === 'lazy') withLazyLoad++;
            });

            data.images.total = images.length;
            data.images.withAlt = withAlt;
            data.images.withoutAlt = withoutAlt;
            data.images.withLazyLoad = withLazyLoad;
            data.images.altPercentage = images.length > 0 ? Math.round((withAlt / images.length) * 100) : 100;

            // Schema.org
            doc.querySelectorAll('script[type="application/ld+json"]').forEach(script => {
              try { data.schema.push(JSON.parse(script.textContent)); }
              catch {}
            });

            // Resource counts
            data.technical.scriptCount = doc.querySelectorAll('script').length;
            data.technical.inlineScripts = doc.querySelectorAll('script:not([src])').length;
            data.technical.externalScripts = doc.querySelectorAll('script[src]').length;
            data.technical.styleCount = doc.querySelectorAll('style, link[rel="stylesheet"]').length;
            data.technical.inlineStyles = doc.querySelectorAll('style').length;
            data.technical.externalStyles = doc.querySelectorAll('link[rel="stylesheet"]').length;

            return data;
          }

          // ===== SCORING =====
          function calculateScores(seo, ps) {
            const scores = {
              overall: 0,
              technical: 0,
              content: 0,
              performance: null,
              accessibility: null,
              seo: null,
              bestPractices: null,
              hasPageSpeed: false,
            };

            const cats = ps?.lighthouseResult?.categories;
            if (cats) {
              scores.hasPageSpeed = true;
              scores.performance = cats.performance?.score != null ? Math.round(cats.performance.score * 100) : null;
              scores.accessibility = cats.accessibility?.score != null ? Math.round(cats.accessibility.score * 100) : null;
              scores.seo = cats.seo?.score != null ? Math.round(cats.seo.score * 100) : null;
              scores.bestPractices = cats['best-practices']?.score != null ? Math.round(cats['best-practices'].score * 100) : null;
            }

            // Technical score
            let tech = 0;
            const titleLen = seo.meta?.titleLength || 0;
            const descLen = seo.meta?.descriptionLength || 0;

            if (titleLen >= 30 && titleLen <= 60) tech += 20;
            else if (titleLen > 0) tech += 10;

            if (descLen >= 120 && descLen <= 160) tech += 20;
            else if (descLen > 0) tech += 10;

            if (seo.headings?.h1?.count === 1) tech += 15;
            else if (seo.headings?.h1?.count > 0) tech += 8;

            if (seo.technical?.isHttps) tech += 15;
            if (seo.technical?.hasViewport) tech += 10;
            if (seo.meta?.canonical) tech += 10;
            if (seo.schema?.length > 0) tech += 10;

            scores.technical = Math.min(100, tech);

            // Content score
            let content = 0;
            const wordCount = seo.content?.wordCount || 0;

            if (wordCount >= 1000) content += 30;
            else if (wordCount >= 500) content += 25;
            else if (wordCount >= 300) content += 20;
            else if (wordCount >= 100) content += 10;

            content += Math.round((seo.images?.altPercentage || 0) / 4);

            const flesch = seo.content?.fleschScore || 50;
            if (flesch >= 60) content += 25;
            else if (flesch >= 40) content += 15;
            else content += 8;

            if (seo.headings?.h1?.count === 1 && seo.headings?.h2?.count >= 2) content += 20;
            else if (seo.headings?.h1?.count > 0) content += 10;

            scores.content = Math.min(100, Math.round(content));

            // Overall
            if (scores.hasPageSpeed && scores.performance !== null && scores.seo !== null) {
              scores.overall = Math.round(
                scores.technical * 0.2 +
                scores.content * 0.15 +
                (scores.performance || 0) * 0.25 +
                (scores.seo || 0) * 0.25 +
                (scores.accessibility || 0) * 0.15
              );
            } else {
              scores.overall = Math.round((scores.technical + scores.content) / 2);
            }

            return scores;
          }

          // ===== SIMPLE LOCAL AI FALLBACK (PLACEHOLDER) =====
          function generateLocalRecommendations(seo, scores) {
            const issues = [];
            const wins = [];
            const technical = [];
            const content = [];
            const advanced = [];

            if (!seo.meta?.titleLength) issues.push('Missing page title - this is critical for SEO');
            else if (seo.meta?.titleLength < 30) wins.push('Title is too short - aim for 50-60 characters');
            else if (seo.meta?.titleLength > 60) wins.push('Title may be truncated in search results - trim to 60 characters');

            if (!seo.meta?.descriptionLength) issues.push('Missing meta description - add a compelling 150-160 character description');
            else if (seo.meta?.descriptionLength < 120) wins.push('Meta description is short - expand to 150-160 characters for better CTR');

            if (seo.headings?.h1?.count !== 1) issues.push(`Page has ${seo.headings?.h1?.count} H1 tags - should have exactly one`);

            if (seo.images?.withoutAlt > 0) wins.push(`Add alt text to ${seo.images.withoutAlt} images for accessibility and SEO`);
            if (!seo.technical?.isHttps) issues.push('Site is not using HTTPS - this is a ranking factor');
            if (!seo.schema?.length) technical.push('Add Schema.org structured data for rich snippets');
            if (!seo.meta?.ogTitle) wins.push('Add Open Graph tags for better social media sharing');

            if ((seo.content?.wordCount || 0) < 300) content.push('Content is thin - aim for at least 1000+ words for competitive topics');
            if ((seo.content?.fleschScore || 50) < 60) content.push('Improve readability - use shorter sentences and simpler words');
            if ((seo.links?.internalCount || 0) < 5) technical.push('Add more internal links to improve site structure');

            advanced.push('Implement Core Web Vitals optimization for LCP, INP, and CLS');
            advanced.push('Create a content calendar for regular, fresh content');
            advanced.push('Build quality backlinks through outreach and content marketing');

            const summaryScore = scores.overall >= 80 ? 'good' : scores.overall >= 50 ? 'moderate' : 'poor';

            return `
              <h4>üìã Executive Summary</h4>
              <p>Your website has a <strong>${summaryScore}</strong> overall SEO score of ${scores.overall}/100. ${issues.length > 0 ? `There are ${issues.length} critical issues that need immediate attention.` : 'No critical issues found.'}</p>

              <h4>üö® Critical Issues</h4>
              <ul>${issues.length > 0 ? issues.map(i => `<li>${i}</li>`).join('') : '<li>No critical issues detected!</li>'}</ul>

              <h4>üöÄ Quick Wins</h4>
              <ul>${wins.length > 0 ? wins.map(w => `<li>${w}</li>`).join('') : '<li>Looking good! Focus on advanced optimizations.</li>'}</ul>

              <h4>üìù Content Strategy</h4>
              <ul>${content.length > 0 ? content.map(c => `<li>${c}</li>`).join('') : '<li>Content fundamentals are solid. Consider expanding with long-form content.</li>'}</ul>

              <h4>‚öôÔ∏è Technical Fixes</h4>
              <ul>${technical.length > 0 ? technical.map(t => `<li>${t}</li>`).join('') : '<li>Technical SEO is in good shape. Monitor for issues.</li>'}</ul>

              <h4>üîÆ Advanced Recommendations</h4>
              <ul>${advanced.map(a => `<li>${a}</li>`).join('')}</ul>
            `;
          }

          // ===== RENDER FUNCTIONS =====
          function renderStatusBanner(ps, html) {
            const banner = document.getElementById('status-banner');
            const hasPS = ps && ps.lighthouseResult;
            const hasHTML = html !== null;

            if (hasPS && hasHTML) {
              banner.className = 'status-banner success';
              banner.innerHTML = `<span class="status-icon">‚úÖ</span><span>Full analysis complete! PageSpeed API and HTML parsing both successful.</span>`;
            } else if (!hasPS && hasHTML) {
              banner.className = 'status-banner warning';
              banner.innerHTML = `<span class="status-icon">‚ö†Ô∏è</span><span>PageSpeed API unavailable. Performance scores estimated. Technical analysis from HTML parsing. ${APP.lastError ? `Error: ${APP.lastError}` : ''}</span>`;
            } else if (hasPS && !hasHTML) {
              banner.className = 'status-banner warning';
              banner.innerHTML = `<span class="status-icon">‚ö†Ô∏è</span><span>HTML parsing blocked by CORS. Using PageSpeed API data only. Some detailed analysis unavailable.</span>`;
            } else {
              banner.className = 'status-banner error';
              banner.innerHTML = `<span class="status-icon">‚ùå</span><span>Limited analysis. Both data sources failed. ${APP.lastError ? `Error: ${APP.lastError}` : ''}</span>`;
            }
          }

          function renderSitePreview(seo, ps) {
            const favicon = `https://www.google.com/s2/favicons?domain=${seo.domain}&sz=128`;
            const screenshot = ps?.lighthouseResult?.audits?.['final-screenshot']?.details?.data;
            document.getElementById('site-preview').innerHTML = `
              <div class="site-favicon"><img src="${favicon}" alt="" onerror="this.parentElement.innerHTML='üåê'" /></div>
              <div class="site-info"><h3>${seo.meta?.title || seo.domain}</h3><a href="${seo.url}" target="_blank">${seo.url}</a></div>
              ${screenshot ? `<div class="site-screenshot"><img src="${screenshot}" alt="Screenshot" /></div>` : ''}
            `;
          }

          function renderStats(seo, scores) {
            document.getElementById('stats-row').innerHTML = `
              <div class="stat-card"><div class="stat-value" style="color: ${getScoreColor(scores.overall)}">${scores.overall}</div><div class="stat-label">Overall Score</div></div>
              <div class="stat-card"><div class="stat-value">${seo.content?.wordCount || 0}</div><div class="stat-label">Words</div></div>
              <div class="stat-card"><div class="stat-value">${seo.links?.totalCount || 0}</div><div class="stat-label">Total Links</div></div>
              <div class="stat-card"><div class="stat-value">${seo.images?.total || 0}</div><div class="stat-label">Images</div></div>
              <div class="stat-card"><div class="stat-value" style="color: ${(seo.images?.withoutAlt || 0) > 0 ? 'var(--accent-red)' : 'var(--accent-green)'}">${seo.images?.withoutAlt || 0}</div><div class="stat-label">Missing Alt</div></div>
              <div class="stat-card"><div class="stat-value">${seo.headings?.h1?.count || 0}</div><div class="stat-label">H1 Tags</div></div>
            `;
          }

          function renderScores(scores, containerId = 'score-dashboard') {
            const items = [
              { key: 'overall', label: 'Overall' },
              { key: 'technical', label: 'Technical' },
              { key: 'content', label: 'Content' },
              { key: 'performance', label: 'Performance' },
              { key: 'seo', label: 'SEO' },
              { key: 'accessibility', label: 'Access.' },
            ];

            const circumference = 2 * Math.PI * 42;

            document.getElementById(containerId).innerHTML = items
              .map(({ key, label }) => {
                const score = scores[key];
                const isNA = score === null || score === undefined;
                const displayScore = isNA ? 'N/A' : score;
                const offset = isNA ? circumference : circumference - (score / 100) * circumference;
                const color = getScoreColor(score, isNA);

                return `
                  <div class="score-card">
                    <div class="score-ring">
                      <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="42" />
                        <circle class="progress" cx="50" cy="50" r="42" stroke="${color}" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" />
                      </svg>
                      <span class="score-value" style="color: ${color}; font-size: ${isNA ? '16px' : '28px'}">${displayScore}</span>
                    </div>
                    <div class="score-label">${label}</div>
                    ${isNA ? '<div class="score-na">API unavailable</div>' : ''}
                  </div>
                `;
              })
              .join('');
          }

          function renderFindings(seo, scores, ps) {
            const findings = [];
            const audits = ps?.lighthouseResult?.audits || {};

            if (!scores.hasPageSpeed) findings.push({ type: 'warning', title: 'Limited Data', desc: 'PageSpeed API unavailable - some metrics estimated.' });
            if (scores.overall >= 80) findings.push({ type: 'success', title: 'Strong SEO Foundation', desc: 'Your site has solid SEO fundamentals in place.' });
            else if (scores.overall < 50) findings.push({ type: 'critical', title: 'SEO Needs Work', desc: 'Score indicates significant room for improvement.' });

            if (audits['document-title']?.score === 0) findings.push({ type: 'critical', title: 'Missing Page Title', desc: 'Add a unique, descriptive title tag.' });
            if (audits['meta-description']?.score === 0) findings.push({ type: 'critical', title: 'Missing Meta Description', desc: 'Add a compelling description for better CTR.' });

            if (audits['image-alt']?.details?.items?.length > 0) {
              findings.push({ type: 'warning', title: 'Images Missing Alt Text', desc: `${audits['image-alt'].details.items.length} images need alt attributes.` });
            }

            if (scores.performance !== null && scores.performance < 50) {
              findings.push({ type: 'critical', title: 'Poor Performance', desc: `Performance score of ${scores.performance}/100 needs optimization.` });
            }

            if (!seo.technical?.isHttps) findings.push({ type: 'critical', title: 'No HTTPS', desc: 'Enable SSL for security and ranking benefits.' });
            if (seo.headings?.h1?.count !== 1) findings.push({ type: 'warning', title: 'H1 Tag Issue', desc: `Found ${seo.headings?.h1?.count} H1 tags. Should have exactly one.` });

            document.getElementById('key-findings').innerHTML =
              findings
                .slice(0, 6)
                .map(f => `
                  <li class="issue-item">
                    <div class="issue-icon ${f.type}">${f.type === 'critical' ? '‚ö†Ô∏è' : f.type === 'warning' ? '‚ö°' : '‚úì'}</div>
                    <div class="issue-content"><h5>${f.title}</h5><p>${f.desc}</p></div>
                  </li>
                `)
                .join('') ||
              '<li class="issue-item"><div class="issue-icon success">‚úì</div><div class="issue-content"><h5>Looking Good!</h5><p>No major issues detected.</p></div></li>';
          }

          function renderQuickWins(seo) {
            const wins = [];

            if (seo.meta?.titleLength > 60) wins.push({ title: 'Shorten Title', desc: 'Keep under 60 characters to avoid truncation.' });
            else if (!seo.meta?.titleLength) wins.push({ title: 'Add Page Title', desc: 'Create a unique, keyword-rich title (50-60 chars).' });

            if (!seo.meta?.descriptionLength) wins.push({ title: 'Add Meta Description', desc: 'Write a compelling 150-160 character description.' });
            if ((seo.images?.withoutAlt || 0) > 0) wins.push({ title: 'Add Image Alt Text', desc: `${seo.images.withoutAlt} images need descriptive alt attributes.` });
            if (!seo.meta?.ogImage) wins.push({ title: 'Add OG Image', desc: 'Improve social media appearance with Open Graph image.' });
            if (!seo.schema?.length) wins.push({ title: 'Add Schema Markup', desc: 'Enable rich snippets with structured data.' });
            if (!seo.meta?.canonical) wins.push({ title: 'Add Canonical Tag', desc: 'Prevent duplicate content issues.' });

            document.getElementById('quick-wins').innerHTML =
              wins
                .slice(0, 5)
                .map(w => `
                  <li class="issue-item">
                    <div class="issue-icon info">üöÄ</div>
                    <div class="issue-content"><h5>${w.title}</h5><p>${w.desc}</p></div>
                  </li>
                `)
                .join('') ||
              '<li class="issue-item"><div class="issue-icon success">‚úì</div><div class="issue-content"><h5>Great Job!</h5><p>No quick wins needed - focus on advanced optimizations.</p></div></li>';
          }

          function updateStatus(elId, score) {
            const el = document.getElementById(elId);
            const cls = getStatusClass(score, score === null || score === undefined);
            el.className = `status-pill ${cls}`;
            el.textContent = cls === 'status-good' ? 'Good' : cls === 'status-warning' ? 'Warn' : cls === 'status-error' ? 'Fix' : 'N/A';
          }

          function renderTechnical(seo) {
            // Minimal: show just a few highlights. Extend as needed.
            updateStatus('meta-status', 80);
            document.getElementById('meta-analysis').innerHTML = `
              <div class="data-row"><span class="data-label">üìå Title Tag</span><span class="data-value">${seo.meta?.title || 'Missing'}</span></div>
              <div class="data-row"><span class="data-label">üìù Meta Description</span><span class="data-value">${seo.meta?.descriptionLength ? seo.meta.descriptionLength + ' characters' : 'Missing'}</span></div>
              <div class="data-row"><span class="data-label">üîó Canonical URL</span><span class="data-value">${seo.meta?.canonical ? '‚úì Set' : '‚ùå Not set'}</span></div>
            `;

            updateStatus('heading-status', seo.headings?.h1?.count === 1 ? 100 : 50);
            document.getElementById('heading-analysis').innerHTML = `
              <div class="metrics-grid">
                ${['h1','h2','h3','h4'].map(tag => `
                  <div class="metric-box"><div class="metric-value">${seo.headings?.[tag]?.count || 0}</div><div class="metric-label">${tag.toUpperCase()} Tags</div></div>
                `).join('')}
              </div>
            `;

            updateStatus('security-status', seo.technical?.isHttps ? 100 : 0);
            document.getElementById('security-analysis').innerHTML = `
              <div class="data-row"><span class="data-label">üîí HTTPS</span><span class="data-value" style="color: ${seo.technical?.isHttps ? 'var(--accent-green)' : 'var(--accent-red)'}">${seo.technical?.isHttps ? '‚úì Enabled' : '‚ùå Not Enabled'}</span></div>
            `;

            updateStatus('mobile-status', seo.technical?.hasViewport ? 100 : 0);
            document.getElementById('mobile-analysis').innerHTML = `
              <div class="data-row"><span class="data-label">üì± Viewport Meta</span><span class="data-value">${seo.technical?.hasViewport ? '‚úì Set' : '‚ùå Missing'}</span></div>
              <div class="data-row"><span class="data-label">üìê Viewport Content</span><span class="data-value" style="font-size: 11px;">${seo.technical?.viewportContent || 'N/A'}</span></div>
            `;

            updateStatus('schema-status', seo.schema?.length ? 100 : 0);
            document.getElementById('schema-analysis').innerHTML = seo.schema?.length
              ? `<p style="margin-bottom: 12px; color: var(--accent-green);">‚úì ${seo.schema.length} schema type(s) found</p><div class="code-block">${JSON.stringify(seo.schema, null, 2)}</div>`
              : '<p style="color: var(--text-muted);">‚ùå No Schema.org structured data found. Consider adding JSON-LD markup.</p>';

            updateStatus('crawl-status', 80);
            document.getElementById('crawl-analysis').innerHTML = `
              <div class="data-row"><span class="data-label">üåê Language</span><span class="data-value">${seo.technical?.lang || 'Not specified'}</span></div>
              <div class="data-row"><span class="data-label">üìÑ Character Set</span><span class="data-value">${seo.technical?.charset || 'Not specified'}</span></div>
            `;
          }

          function renderContent(seo) {
            document.getElementById('content-stats').innerHTML = `
              <div class="metrics-grid">
                <div class="metric-box"><div class="metric-value">${seo.content?.wordCount || 0}</div><div class="metric-label">Words</div></div>
                <div class="metric-box"><div class="metric-value">${seo.content?.sentenceCount || 0}</div><div class="metric-label">Sentences</div></div>
                <div class="metric-box"><div class="metric-value">${seo.content?.avgWordsPerSentence || 0}</div><div class="metric-label">Avg Words/Sent</div></div>
                <div class="metric-box"><div class="metric-value">${seo.content?.fleschScore || 0}</div><div class="metric-label">Readability</div></div>
              </div>
            `;

            const keywords = seo.content?.topKeywords || [];
            document.getElementById('keyword-analysis').innerHTML = keywords.length
              ? `<p style="margin-bottom: 16px; font-size: 13px; color: var(--text-secondary);">Top keywords by frequency:</p>
                 <div class="keywords-cloud">${keywords.slice(0, 15).map((k, i) => `<span class="keyword-tag ${i < 5 ? 'primary' : ''}">${k.word} <span style="opacity: 0.6">(${k.count})</span></span>`).join('')}</div>`
              : '<p style="color: var(--text-muted);">No significant keywords detected. Add more content.</p>';

            updateStatus('image-status', seo.images?.altPercentage || 100);
            document.getElementById('image-analysis').innerHTML = `
              <div class="metrics-grid">
                <div class="metric-box"><div class="metric-value">${seo.images?.total || 0}</div><div class="metric-label">Total Images</div></div>
                <div class="metric-box"><div class="metric-value" style="color: var(--accent-green)">${seo.images?.withAlt || 0}</div><div class="metric-label">With Alt</div></div>
                <div class="metric-box"><div class="metric-value" style="color: ${(seo.images?.withoutAlt || 0) > 0 ? 'var(--accent-red)' : 'var(--accent-green)'}">${seo.images?.withoutAlt || 0}</div><div class="metric-label">Missing Alt</div></div>
                <div class="metric-box"><div class="metric-value">${seo.images?.altPercentage || 100}%</div><div class="metric-label">Alt Coverage</div></div>
              </div>
            `;

            const flesch = seo.content?.fleschScore || 50;
            const readabilityLevel =
              flesch >= 80 ? 'Very Easy (5th grade)' :
              flesch >= 60 ? 'Easy (6th-8th grade)' :
              flesch >= 40 ? 'Moderate (9th-12th grade)' :
              flesch >= 20 ? 'Difficult (College)' :
              'Very Difficult';

            document.getElementById('readability-analysis').innerHTML = `
              <div style="text-align: center; padding: 20px;">
                <div style="font-size: 48px; font-weight: 700; color: ${getScoreColor(flesch)}">${flesch}</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">${readabilityLevel}</div>
              </div>
              <div class="progress-bar" style="height: 12px; border-radius: 6px;"><div class="progress-fill" style="width: ${flesch}%; background: ${getScoreColor(flesch)}; border-radius: 6px;"></div></div>
            `;
          }

          function renderPerformance(ps, scores) {
            renderScores({
              performance: scores.performance,
              accessibility: scores.accessibility,
              bestPractices: scores.bestPractices,
              seo: scores.seo,
              overall: scores.overall,
              technical: scores.technical,
              content: scores.content,
            }, 'perf-scores');

            if (!ps || !ps.lighthouseResult) {
                // Fallback if no PageSpeed data
                document.getElementById('vitals-analysis').innerHTML = '<p style="color: var(--text-muted);">No performance data available.</p>';
                return;
            }

            const audits = ps.lighthouseResult.audits;

            // 1. Core Web Vitals
            const metrics = [
                { id: 'first-contentful-paint', label: 'First Contentful Paint' },
                { id: 'largest-contentful-paint', label: 'Largest Contentful Paint' },
                { id: 'total-blocking-time', label: 'Total Blocking Time' },
                { id: 'cumulative-layout-shift', label: 'Cumulative Layout Shift' },
                { id: 'speed-index', label: 'Speed Index' }
            ];

            let vitalsHtml = '<div class="metrics-grid">';
            metrics.forEach(m => {
                const audit = audits[m.id];
                if (audit) {
                    const score = audit.score;
                    const color = score >= 0.9 ? 'var(--accent-green)' : (score >= 0.5 ? 'var(--accent-yellow)' : 'var(--accent-red)');
                    vitalsHtml += `
                        <div class="metric-box">
                            <div class="metric-value" style="color: ${color}">${audit.displayValue}</div>
                            <div class="metric-label">${m.label}</div>
                        </div>`;
                }
            });
            vitalsHtml += '</div>';
            document.getElementById('vitals-analysis').innerHTML = vitalsHtml;

            // 2. Filmstrip
            const filmstrip = audits['screenshot-thumbnails'];
            if (filmstrip && filmstrip.details && filmstrip.details.items) {
                const thumbs = filmstrip.details.items;
                // Take up to 10 frames spread out
                const step = Math.ceil(thumbs.length / 10) || 1;
                let filmHtml = '<div style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;">';
                for(let i=0; i<thumbs.length; i+=step) {
                    const t = thumbs[i];
                    filmHtml += `<div style="flex: 0 0 auto; text-align: center;">
                        <img src="${t.data}" style="height: 100px; border: 1px solid var(--border-subtle); border-radius: 4px;">
                        <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">${t.timing}ms</div>
                    </div>`;
                }
                filmHtml += '</div>';
                document.getElementById('filmstrip').innerHTML = filmHtml;
            } else {
                document.getElementById('filmstrip').innerHTML = '<p style="color: var(--text-muted);">No screenshots available.</p>';
            }

            // 3. Resource Summary
            const resources = audits['resource-summary'];
            if (resources && resources.details && resources.details.items) {
                let resHtml = '<div style="display: flex; flex-direction: column; gap: 8px;">';
                resources.details.items.forEach(item => {
                    if (item.label === 'Total') return; // Skip total row usually
                    resHtml += `
                        <div style="display: flex; justify-content: space-between; font-size: 13px; border-bottom: 1px solid var(--border-subtle); padding: 8px 0;">
                            <span>${item.label}</span>
                            <span>${item.transferSize ? (item.transferSize / 1024).toFixed(1) + ' KB' : '-'}</span>
                        </div>
                    `;
                });
                resHtml += '</div>';
                document.getElementById('resource-analysis').innerHTML = resHtml;
            }

            // 4. Opportunities
            // Filter audits for opportunities
            const opportunities = Object.values(audits)
                .filter(a => a.details && a.details.type === 'opportunity' && a.score < 0.9)
                .sort((a, b) => (a.score - b.score)) // Lower score first (worse performance)
                .slice(0, 5);

            if (opportunities.length > 0) {
                let oppHtml = '<ul class="issues-list">';
                opportunities.forEach(op => {
                    const savings = op.details.overallSavingsMs ? `${Math.round(op.details.overallSavingsMs)}ms potential savings` : '';
                    oppHtml += `
                        <li class="issue-item">
                            <div class="issue-icon warning">‚ö°</div>
                            <div class="issue-content">
                                <h5>${op.title}</h5>
                                <p>${op.description.split('[')[0]} <span style="color: var(--accent-cyan)">${savings}</span></p>
                            </div>
                        </li>
                    `;
                });
                oppHtml += '</ul>';
                document.getElementById('opportunities').innerHTML = oppHtml;
            } else {
                document.getElementById('opportunities').innerHTML = '<p style="color: var(--accent-green);">No major optimization opportunities found!</p>';
            }
          }

          function renderLinks(seo) {
            const internal = seo.links?.internal || [];
            const external = seo.links?.external || [];

            document.getElementById('internal-links').innerHTML = internal.length
              ? `<div class="code-block">${internal.slice(0, 40).map(l => `${l.href}`).join('\n')}</div>`
              : '<p style="color: var(--text-muted);">No internal links detected.</p>';

            document.getElementById('external-links').innerHTML = external.length
              ? `<div class="code-block">${external.slice(0, 40).map(l => `${l.href}`).join('\n')}</div>`
              : '<p style="color: var(--text-muted);">No external links detected.</p>';

            document.getElementById('link-structure').innerHTML = `<p style="color: var(--text-muted);">Internal: <strong>${internal.length}</strong> ‚Ä¢ External: <strong>${external.length}</strong></p>`;
            document.getElementById('important-files').innerHTML = `<p style="color: var(--text-muted);">(Optional) Detect sitemap.xml / robots.txt via fetch from origin.</p>`;
          }

          function renderChecklist(seo) {
            const onpage = [
              { label: 'Title tag present', pass: !!seo.meta?.titleLength },
              { label: 'Meta description present', pass: !!seo.meta?.descriptionLength },
              { label: 'Single H1', pass: seo.headings?.h1?.count === 1 },
              { label: 'Images have alt text', pass: (seo.images?.withoutAlt || 0) === 0, warn: (seo.images?.withoutAlt || 0) > 0 },
            ];

            const tech = [
              { label: 'HTTPS enabled', pass: !!seo.technical?.isHttps },
              { label: 'Viewport meta set', pass: !!seo.technical?.hasViewport },
              { label: 'Lang attribute set', pass: !!seo.technical?.lang },
              { label: 'Structured data', pass: (seo.schema?.length || 0) > 0, warn: (seo.schema?.length || 0) === 0 },
            ];

            const row = (x) => {
              const state = x.pass ? 'pass' : (x.warn ? 'warn' : 'fail');
              const icon = state === 'pass' ? '‚úì' : state === 'warn' ? '!' : '√ó';
              return `<div class="checklist-item"><div class="checklist-icon ${state}">${icon}</div><div>${x.label}</div></div>`;
            };

            document.getElementById('onpage-checklist').innerHTML = onpage.map(row).join('');
            document.getElementById('technical-checklist').innerHTML = tech.map(row).join('');
          }

          function renderCompetitorAnalysis() {
            const container = document.getElementById('competitors-content');
            if (!APP.competitorData || APP.competitorData.length === 0) return;

            // Helper to safely get values
            const getVal = (obj, path) => path.split('.').reduce((o, k) => (o || {})[k], obj);

            const metrics = [
              { label: 'Overall Score', path: 'scores.overall', isScore: true },
              { label: 'Performance', path: 'scores.performance', isScore: true },
              { label: 'SEO Score', path: 'scores.seo', isScore: true },
              { label: 'Word Count', path: 'seo.content.wordCount' },
              { label: 'H1 Tags', path: 'seo.headings.h1.count' },
              { label: 'Images', path: 'seo.images.total' },
              { label: 'On-Page Links', path: 'seo.links.totalCount' },
            ];

            let html = `
              <div class="analysis-card">
                <div class="card-header"><div class="card-title">‚öîÔ∏è Competitor Benchmark</div></div>
                <div class="card-body" style="overflow-x: auto;">
                  <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
                    <thead>
                      <tr style="text-align: left; border-bottom: 2px solid var(--border-default);">
                        <th style="padding: 16px; color: var(--text-secondary); font-size: 12px; text-transform: uppercase;">Metric</th>
                        <th style="padding: 16px; color: var(--accent-cyan); font-size: 14px;">${window.getDomain(APP.url)}<br><span style="font-size:10px; opacity:0.7">(You)</span></th>
                        ${APP.competitors.map(url => `<th style="padding: 16px; font-size: 14px;">${window.getDomain(url)}</th>`).join('')}
                      </tr>
                    </thead>
                    <tbody>
            `;

            metrics.forEach(m => {
              const mainVal = getVal(APP.data, m.path) ?? '-';
              const mainColor = m.isScore ? getScoreColor(mainVal) : 'inherit';
              
              html += `<tr>
                <td style="padding: 16px; border-bottom: 1px solid var(--border-subtle); color: var(--text-muted); font-size: 13px; font-weight: 600;">${m.label}</td>
                <td style="padding: 16px; border-bottom: 1px solid var(--border-subtle); font-family: 'IBM Plex Mono', monospace; font-weight: 700; color: ${mainColor}">${mainVal}</td>`;
                
              APP.competitorData.forEach(d => {
                const val = getVal(d, m.path) ?? '-';
                const color = m.isScore ? getScoreColor(val) : 'inherit';
                html += `<td style="padding: 16px; border-bottom: 1px solid var(--border-subtle); font-family: 'IBM Plex Mono', monospace; color: ${color}">${val}</td>`;
              });
              
              html += `</tr>`;
            });

            html += `</tbody></table></div></div>`;
            container.innerHTML = html;
          }

          async function analyzeSite(targetUrl) {
              const ps = await fetchPageSpeed(targetUrl, 1); // Less retries for competitors to speed up
              const html = await fetchHTML(targetUrl);
              let seo = null;
              if (html) seo = extractSEOData(html, targetUrl);
              else if (ps) seo = { url: targetUrl, domain: window.getDomain(targetUrl), meta: {}, headings: {}, content: {}, links: {}, images: {}, technical: {}, schema: [] };
              else seo = { url: targetUrl, domain: window.getDomain(targetUrl), meta: {}, headings: {}, content: {}, links: {}, images: {}, technical: {}, schema: [] };
              
              const scores = calculateScores(seo, ps);
              return { seo, pageSpeed: ps, scores };
          }

          // ===== EXPORTS =====
          window.exportJSON = function() {
            const blob = new Blob([JSON.stringify(APP.data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `seo-audit-${(APP.data?.seo?.domain || 'site')}.json`;
            a.click();
            URL.revokeObjectURL(a.href);
          };

          window.copyReport = async function() {
            const text = JSON.stringify(APP.data, null, 2);
            await navigator.clipboard.writeText(text);
            alert('Report copied to clipboard.');
          };

          // ===== API TEST / MAIN FLOW =====
          window.testAPI = async function() {
            const demo = 'https://example.com/';
            showLoading(true, 'Testing PageSpeed API...', 'Calling Google PageSpeed Insights', 30);
            const ps = await fetchPageSpeed(demo, 1);
            showLoading(false);
            alert(ps ? '‚úÖ PageSpeed API OK' : `‚ùå PageSpeed API failed\n${APP.lastError || ''}`);
          };

          window.runAnalysis = async function() {
            console.log('runAnalysis triggered');
            const input = document.getElementById('url-input');
            const url = window.normalizeURL(input.value);
            console.log('Normalized URL:', url);
            if (!url) return;

            APP.url = url;
            showLoading(true, 'Running analysis...', 'Fetching Main Site Data', 10);

            // Main Site
            const mainData = await analyzeSite(url);
            APP.data = mainData;

            // Render Main UI (existing calls)
            renderStatusBanner(mainData.pageSpeed, mainData.seo ? "html_present" : null); // Simple check for now
            renderSitePreview(mainData.seo, mainData.pageSpeed);
            renderStats(mainData.seo, mainData.scores);
            renderScores(mainData.scores, 'score-dashboard');
            renderFindings(mainData.seo, mainData.scores, mainData.pageSpeed);
            renderQuickWins(mainData.seo);
            renderTechnical(mainData.seo);
            renderContent(mainData.seo);
            renderPerformance(mainData.pageSpeed, mainData.scores);
            renderLinks(mainData.seo);
            renderChecklist(mainData.seo);
            document.getElementById('results').classList.add('active');

            // Competitors
            if (APP.competitors.length > 0) {
                APP.competitorData = [];
                for (let i=0; i<APP.competitors.length; i++) {
                    const compUrl = APP.competitors[i];
                    showLoading(true, 'Analyzing Competitors...', `Scanning ${window.getDomain(compUrl)}`, 50 + (i/APP.competitors.length * 30));
                    const compData = await analyzeSite(compUrl);
                    APP.competitorData.push(compData);
                }
                renderCompetitorAnalysis();
            } else {
                 document.getElementById('competitors-content').innerHTML = `
              <div class="empty-state">
                <div class="empty-icon">üìä</div>
                <h3>No Competitors Added</h3>
                <p>Add competitor URLs above to see a comparison analysis.</p>
              </div>`;
            }

            // AI
            updateAISection(APP.data.seo, APP.data.scores); // Pass main site data
            showLoading(false);
          };

          // Toggle chip UI sync
          document.querySelectorAll('.toggle-chip').forEach(lbl => {
            lbl.addEventListener('click', (e) => {
              // Allow checkbox state toggling
              if (e.target.tagName !== 'INPUT') {
                const input = lbl.querySelector('input');
                input.checked = !input.checked;
              }
              lbl.classList.toggle('active', lbl.querySelector('input').checked);
            });
          });
      } catch (error) {
        console.error('‚ùå CRITICAL ERROR:', error);
        alert('App failed to initialize. Check console for details.');
      }
    });
  </script>
</body>
</html>
